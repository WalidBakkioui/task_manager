{% extends 'layouts/car.html.twig' %}

{% block headerContent %}
    <header class="header" data-header>
        <div class="container">

            <div class="overlay" data-overlay></div>

            <a href="{{ url('app_home') }}" class="logo">
                <img src="{{ asset('assets/images/logo.png') }}" alt="Ridex logo">
            </a>

            <div class="header-actions">


                <a href="{{ url('app_home') }}" class="btn" aria-labelledby="aria-label-txt">
                    <span id="aria-label-txt">Accueil</span>
                </a>
                {% if app.user and is_granted('ROLE_ADMIN')%}
                    <ul class="admin-nav-ul">
                        <li class="admin-nav-li">
                            <a href="#" class="btn admin-nav-a" aria-labelledby="aria-label-txt ">Admin</a>
                            <ul class="admin-nav-ul">
                                <li class="admin-nav-li">
                                    <a href="{{ url('ajout_create') }}" class="btn admin-nav-a" aria-labelledby="aria-label-txt">
                                        <span class="aria-label-txt">Ajoutez Voiture</span>
                                    </a>
                                </li>
                                <li class="admin-nav-li">
                                    <a href="{{ url('createPhoto') }}" class="btn admin-nav-a" aria-labelledby="aria-label-txt">
                                        <span class="aria-label-txt">Ajout photo</span>
                                    </a>
                                </li>
                                <li class="admin-nav-li">
                                    <a href="{{ url('list_users') }}" class="btn admin-nav-a" aria-labelledby="aria-label-txt">
                                        <span class="aria-label-txt">Utilisateur</span>
                                    </a>
                                </li>
                                <li class="admin-nav-li">
                                    <a href="{{ url('article_list') }}" class="btn admin-nav-a" aria-labelledby="aria-label-txt">
                                        <span class="aria-label-txt">Article</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                {% endif %}
                {% if is_granted('ROLE_USER') or is_granted('ROLE_ADMIN') %}
                    {# Affiche le lien vers la page de profil sauf si l'utilisateur a ROLE_NOT et ROLE_USER #}
                    <a href="{{ url('profil') }}" class="btn user-btn" aria-label="Profile">
                        <ion-icon name="person-outline"></ion-icon>
                    </a>
                {% endif %}
                <a href="{{ url('app_contact') }}" class="btn" aria-labelledby="aria-label-txt">
                    <span id="aria-label-txt">Contact</span>
                </a>


                {% if is_granted('ROLE_USER') or is_granted('ROLE_ADMIN') or is_granted('ROLE_NOT') %}
                    <a href="{{ url('app_logout', {_target_path: path('app_login')}) }}" class="btn btn-red" aria-labelledby="aria-label-txt">
                        <span class="aria-label-txt">Déconnexion</span>
                    </a>
                {% else %}
                    <a href="{{ path('app_login') }}" class="btn btn-red" aria-labelledby="aria-label-txt">
                        <span class="aria-label-txt">Connexion</span>
                    </a>
                {% endif %}

                <button class="nav-toggle-btn" data-nav-toggle-btn aria-label="Toggle Menu">
                    <span class="one"></span>
                    <span class="two"></span>
                    <span class="three"></span>
                </button>

            </div>

        </div>
    </header>
{% endblock %}

{% block content %}
    <main>
        <article>
            <section class="section hero" id="home">
                <div class="container">
                    <div class="hero-content space-title-profil">
                        <h1>Rechercher des utilisateurs</h1>
                        <form action="{{ path('list_users') }}" method="get" class="search-form">
                            <label for="search">Rechercher par email :</label>
                            <input type="text" name="search" id="search" value="{{ search }}" />
                            <button class="btn" type="submit">Rechercher</button>
                        </form>
                    </div>

                    <h1 class="space-title-profil">Liste des utilisateurs</h1>
                    <table class="table-custom">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Roles</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for user in users %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.roles | join(', ') }}</td>
                                <td>
                                    <form method="post" action="{{ path('modify_user_role', {'id': user.id}) }}">
                                        <select name="new_role" class="form-control">
                                            <option value="ROLE_USER" {% if 'ROLE_USER' in user.roles %}selected{% endif %}>Utilisateur</option>
                                            <option value="ROLE_ADMIN" {% if 'ROLE_ADMIN' in user.roles %}selected{% endif %}>Administrateur</option>
                                            <option value="ROLE_NOT" {% if 'ROLE_NOT' in user.roles %}selected{% endif %}>Aucun rôle</option>
                                        </select>
                                        <button type="submit" class="btn btn-primary">Modifier le rôle</button>
                                    </form>
                                    <form method="post" action="{{ path('edit_user', {'id': user.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir modifier cet utilisateur ?');">
                                        <button type="submit" class="btn btn-danger">Modifier</button>
                                    </form>

                                    <form method="post" action="{{ path('delete_user', {'id': user.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                        <button type="submit" class="btn btn-danger">Supprimer</button>
                                    </form>

                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                </div>
            </section>
        </article>
    </main>
{% endblock %}